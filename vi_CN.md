English version: [vi_EN](https://github.com/Ryanluoxu/learn_linux/blob/master/vi_EN.md)

# 目录
1. [操作状态](#操作状态)
2. [vi 指令](#指令)
    1. [进入插入模式](#进入插入模式)
    2. [移动光标](#移动光标)
    3. [删除文字](#删除文字)
    4. [复制，粘贴，移动](#复制粘贴移动)
    5. [搜索,替换](#搜索替换)
    6. [最后行方式命令](#最后行方式命令)
    7. [寄存器操作](#寄存器操作)
    8. [选项设置](#选项设置)
3. [简单应用](#简单应用)
4. [相关链接](#相关链接)

# 正文
## 操作状态 <a name="操作状态"></a>
1. 命令模式  
    - 光标的移动
    - 字符，光标的删除
    - 移动，复制某区段
    - 进入其他模式

2. 插入模式
    - 数据输入
    - `esc` 回到命令模式
    
3. 底线命令模式 （ 可并入命令模式 ）
    - 储存文件，离开编辑器
    - 设置编辑环境：寻找字符串，列出行号等
    
## vi 指令 <a name="指令"></a>

- 用 vi 打开文件： `vi filename`

### 进入插入模式：`i` `a` `o` <a name=""></a>
- 从光标所在之处插入文字：`i`
- 从光标所在之处等下一个位置输入文字：`a`
- 插入新的一行，从行首开始输入文字：`o`

### 保存以及退出 (在命令模式下) <a name="进入插入模式"></a>
- 将数据存入指定文件：`:w filename`
- 保存：`:w`
- 保存并退出：`:wq`
- 不保存并退出：`:q!`

### 移动光标 (在命令模式下) <a name="移动光标"></a>
- `h`左 `j`下 `k`上 `l`右
- 下一页：`ctrl+b`
- 上一页：`ctrl+f`
- 下半页：`ctrl+u`
- 上半页：`ctrl+d`
- 文件开头：`0`
- 文件结尾：`G`
- 下一个单词的开头：`w`
- 下一个单词的结尾：`e`
- 上一个单词的开头：`b`
- 行尾：`$`
- 行首：`0`
- 所在行的第一个非空白字符：`^`
- 移到所在行的第#个位置：`#`
- 至段落开头：`}` 
- 至段落结尾：`{` 
- 下移n行：`n+` 
- 上移n行：`n-` 
- 至屏幕顶行：`H` 
- 至屏幕中间行：`M` 
- 至屏幕最后行：`L`


### 删除文字 (在命令模式下) <a name="删除文字"></a>
- 删除后一个字符：`x`
- 删除后面#个字符：`#x`
- 删除前一个字符：`X`
- 删除前面#个字符：`#X`
- 删除所在行：`dd`
- 删除以下#行（包括本行）：`#dd`
- 删至行首：`do` 
- 删至行尾：`d$` 
- 删除输入方式下所输入的文本：`ctrl+u` 
- 将n1行到n2行之间的内容删除：`:n1,n2 d` 


### 复制，粘贴，移动 (在命令模式下) <a name="复制粘贴移动"></a>
- 复制所在位置-字尾：`yw`
- 复制所在行：`yy`
- 粘贴：`p`
- 复制以下#行（包括本行）：`#yy`
- 复制所在行到缓存a：`ayy`
- 粘贴缓存a里的内容：`ap`
- 将n1行到n2行之间的内容拷贝到第n3行下：`:n1,n2 co n3`
- 将n1行到n2行之间的内容移至到第n3行下：`:n1,n2 m n3`

### 搜索,替换 <a name="搜索替换"></a>
- 向文件尾搜索pattern：`/pattern`
- 向文件首搜索pattern：`?pattern`-
- 同一方向重复上一次搜索命令：`n` 
- 反方向上重复上一次搜索命令：`N`
- 将当前行中所有p1均用p2替代：`:s/p1/p2/g`
- 将第n1至n2行中所有p1均用p2替代：`:n1,n2s/p1/p2/g`
- 将文件中所有p1均用p2替换：`:g/p1/s//p2/g`

### 最后行方式命令 <a name="最后行方式命令"></a>
- `:e filename`：打开文件filename进行编辑 
- `:!command`：执行shell命令command 
- `:n1,n2 w!command`：将文件中n1行至n2行的内容作为command的输入并执行之，若不指定n1，n2，则表示将整个文件内容作为command的输入 
- `:r!command`：将命令command的输出结果放到当前行 

### 寄存器操作 <a name="寄存器操作"></a>
- `"?nyy`：将当前行及其下n行的内容保存到寄存器？中，其中?为一个字母，n为一个数字 
- `"?nyw`：将当前行及其下n个字保存到寄存器？中，其中?为一个字母，n为一个数字 
- `"?nyl`：将当前行及其下n个字符保存到寄存器？中，其中?为一个字母，n为一个数字 
- `"?p`：取出寄存器？中的内容并将其放到光标位置处。这里？可以是一个字母，也可以是一个数字 
- `ndd`：将当前行及其下共n行文本删除，并将所删内容放到1号删除寄存器中。

### 选项设置 <a name="选项设置"></a>
- `all`：列出所有选项设置情况 
- `term`：设置终端类型 
- `ignorance`：在搜索中忽略大小写 
- `list`：显示制表位(Ctrl+I)和行尾标志
- `number`：显示行号 
- `report`：显示由面向行的命令修改过的数目 
- `terse`：显示简短的警告信息 
- `warn`：在转到别的文件时若没保存当前文件则显示NO write信息 
- `nomagic`：允许在搜索模式中，使用前面不带“\”的特殊字符 
- `nowrapscan`：禁止vi在搜索到达文件两端时，又从另一端开始 
- `mesg`：允许vi显示其他用户用write写到自己终端上的信息 


## 简单应用 <a name="简单应用"></a>
来源：[linux下vi命令大全](http://www.cnblogs.com/88999660/articles/1581524.html)

 1．在一个新文件中读/etc/passwd中的内容，取出用户名部分。 
 vi file 
 :r /etc/passwd 在打开的文件file中光标所在处读入/etc/passwd 
 :%s/:.*//g 删除/etc/passwd中用户名后面的从冒号开始直到行尾的所有部分。 
 您也可以在指定的行号后读入文件内容，例如使用命令“:3r /etc/passwd”从新文件的第3行开始读入 /etc/passwd的所有内容。 
 我们还可以使用以下方法删掉文件中所有的空行及以#开始的注释行。 
 #cat squid.conf.default | grep -v ^$ | grep -v ^# 

 2．在打开一个文件编辑后才知道登录的用户对该文件没有写的权限，不能存盘，需要将所做修改存入临时文件。 
 vi file 
 :w /tmp/1 保存所做的所有修改，也可以将其中的某一部分修改保存到临时文件，例如仅仅把第20～59行之间的内容存盘成文件/tmp/1，我们可以键入如下命令。 
 vi file 
 :20,59w /tmp/1 

 3．用VI编辑一个文件，但需要删除大段的内容。 
 首先利用编辑命令“vi file”打开文件，然后将光标移到需要删除的行处按Ctrl+G显示行号，再到结尾处再按Ctrl+G，显示文件结尾的行号。 
 :23,1045d 假定2次得到的行号为23和1045，则把这期间的内容全删除，也可以在要删除的开始行和结束行中用ma、mb命令标记，然后利用“:a,bd”命令删除。 

 4．在整个文件的各行或某几行的行首或行尾加一些字符串。 
 vi file 
 :3,$s/^/some string / 在文件的第一行至最后一行的行首插入“some string”。 
 :%s/$/some string/g 在整个文件每一行的行尾添加“some string”。 
 :%s/string1/string2/g 在整个文件中替换“string1”成“string2”。 
 :3,7s/string1/string2/ 仅替换文件中的第3行到第7行中的“string1”成“string2”。 
 注意: 其中s为substitute，%表示所有行，g表示global。 

 5．同时编辑2个文件，拷贝一个文件中的文本并粘贴到另一个文件中。 
 vi file1 file2 
 yy 在文件1的光标处拷贝所在行 
 :n 切换到文件2 (n=next) 
 p 在文件2的光标所在处粘贴所拷贝的行 
 :n 切换回文件1 

 6．替换文件中的路径。 
 使用命令“:%s#/usr/bin#/bin#g”可以把文件中所有路径/usr/bin换成/bin。也可以使用命令“:%s//usr/bin//bin/g”实现，其中“”是转义字符，表明其后的“/”字符是具有实际意义的字符，不是分隔符。
 

## 相关链接 <a name="相关链接"></a>
1. [vi指令說明(完整版)](http://www2.nsysu.edu.tw/csmlab/unix/vi_command.htm)
2. []()
3. []()
